import os
from tkinter import Image

import numpy as np

from images_processing_model.data_preparation.paths import DECIMAL_FOLDER_PATH, IMAGES_FOLDER_PATH

directory_input = DECIMAL_FOLDER_PATH
directory_output = IMAGES_FOLDER_PATH

directory = os.fsencode(directory_input)

i = 0
for file in os.listdir(directory):
    filename = os.fsdecode(file)
    if filename.endswith(".bytes"):
        with open(directory_input + "/" + filename) as f:
            name = filename.split('.')[0]
            array_file = [[int(num) for num in line.split(' ')] for line in f]

            last_line = array_file[-1]
            if len(array_file[-1]) != 16:
                last_line = last_line + [0] * (16 - len(array_file[-1]))
                array_file[-1] = last_line

            array = np.array(array_file, dtype=np.uint8)
            temp_image = Image.fromarray(array)
            temp_image.save('temp.png')
            test_image = cv2.imread('temp.png')
            test_image = cv2.resize(test_image, (128, 128))

            resized_image = Image.fromarray(test_image)
            resized_image.save("downsized.png")
            resized_image.save(directory_output + "/" + name + ".png")
        i += 1
        percentage = i / (len(os.listdir(directory)))
        print(f"File: {filename} finished. {percentage * 100} % done")

