import tensorflow as tf
import wandb
import pandas as pd
from wandb.keras import WandbCallback
import numpy as np




conf_dict = {
  "Machine" : "HPEnvy15x360",
  "CPU" : "AMD Ryzen 4700U",
  "batch-size" : 64,
  "epochs" : 10,
}

wandb.init(project="ml-malware-detection")
wandb.config = conf_dict




x_train = pd.read_csv('train.csv')

train_labels = pd.read_csv('trainLabels.csv')

ids = x_train.loc[:,'id']
x_train.drop(columns='id', inplace=True)
input_size = x_train.shape[1]


y_train = []
num_classes = 0
for id in ids:
  if id in train_labels.loc[:,'Id'].to_list():
    temp = train_labels.loc[train_labels['Id'] == id, 'Class'].to_list()
    if temp[0] not in y_train:
      num_classes += 1
    y_train.append(temp[0])
    
    

x_train = np.array(x_train)
y_train = np.array(y_train)
print(y_train)
y_train = tf.keras.utils.to_categorical(y_train, num_classes+1)

print(x_train.shape)
print(y_train.shape)

model = tf.keras.Sequential()
model.add(tf.keras.layers.Dense(16, activation='relu', input_shape=(input_size,)))
model.add(tf.keras.layers.Dense(num_classes+1, activation='softmax'))

model.summary()
model.compile(loss='categorical_crossentropy', optimizer=tf.keras.optimizers.Adam(), metrics=['accuracy'])

history = model.fit(x_train, y_train, batch_size=64, epochs=50, verbose=1, callbacks=WandbCallback())